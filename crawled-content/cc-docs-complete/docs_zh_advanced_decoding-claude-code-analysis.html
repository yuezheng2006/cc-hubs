<div class="fixed flex shadow-lg transition-opacity rounded-xl p-0.5 border bg-fd-muted text-fd-muted-foreground z-10 max-md:hidden xl:start-4 max-xl:end-4 pointer-events-none opacity-0" style="top:calc(var(--fd-banner-height) + var(--fd-tocnav-height) + var(--spacing) * 4)"><button type="button" aria-label="Collapse Sidebar" data-collapsed="false" class="inline-flex items-center justify-center text-sm font-medium transition-colors duration-100 disabled:pointer-events-none disabled:opacity-50 focus-visible:outline-none hover:bg-fd-accent hover:text-fd-accent-foreground p-1.5 [&amp;_svg]:size-4.5 rounded-lg"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide"><rect width="18" height="18" x="3" y="3" rx="2"></rect><path d="M9 3v18"></path></svg></button><button type="button" class="inline-flex items-center justify-center text-sm font-medium transition-colors duration-100 disabled:pointer-events-none disabled:opacity-50 focus-visible:outline-none hover:bg-fd-accent hover:text-fd-accent-foreground p-1.5 [&amp;_svg]:size-4.5 rounded-lg" data-search="" aria-label="Open Search"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg></button></div><aside id="nd-sidebar" data-collapsed="false" class="fixed start-0 flex flex-col items-end top-(--fd-sidebar-top) bottom-(--fd-sidebar-margin) z-20 bg-fd-card text-sm border-e max-md:hidden *:w-(--fd-sidebar-width)" style="transition:top ease 250ms, opacity ease 250ms, translate ease 250ms, width ease 250ms;--fd-sidebar-offset:calc(16px - 100%);--fd-sidebar-margin:0px;--fd-sidebar-top:calc(var(--fd-banner-height) + var(--fd-nav-height) + var(--fd-sidebar-margin));width:calc(var(--fd-sidebar-width) + var(--fd-layout-offset))"><div class="flex flex-col gap-3 p-4 pb-2"><div class="flex"><a class="inline-flex text-[15px] items-center gap-2.5 font-medium me-auto" href="/"><svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" aria-label="Killer Code Logo"><circle cx="12" cy="12" r="12" fill="currentColor"></circle></svg>Killer Code</a><button type="button" aria-label="Collapse Sidebar" data-collapsed="false" class="inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors duration-100 disabled:pointer-events-none disabled:opacity-50 focus-visible:outline-none hover:bg-fd-accent hover:text-fd-accent-foreground p-1.5 [&amp;_svg]:size-4.5 mb-auto text-fd-muted-foreground"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide"><rect width="18" height="18" x="3" y="3" rx="2"></rect><path d="M9 3v18"></path></svg></button></div><button type="button" data-search-full="" class="inline-flex items-center gap-2 rounded-lg border bg-fd-secondary/50 p-1.5 ps-2 text-sm text-fd-muted-foreground transition-colors hover:bg-fd-accent hover:text-fd-accent-foreground"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-4"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>Search<div class="ms-auto inline-flex gap-0.5"><kbd class="rounded-md border bg-fd-background px-1.5">⌘</kbd><kbd class="rounded-md border bg-fd-background px-1.5">K</kbd></div></button></div><div dir="ltr" class="overflow-hidden h-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><div data-radix-scroll-area-viewport="" class="size-full rounded-[inherit] p-4" style="overflow: hidden scroll; --sidebar-item-offset: calc(var(--spacing) * 2); mask-image: linear-gradient(transparent, white 12px, white calc(100% - 12px), transparent);"><div style="min-width:100%;display:table"><a class="relative flex flex-row items-center gap-2 rounded-xl p-2 ps-(--sidebar-item-offset) text-start text-fd-muted-foreground [overflow-wrap:anywhere] [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 transition-colors hover:bg-fd-accent/50 hover:text-fd-accent-foreground/80 hover:transition-none" data-active="false" href="/docs">Best Practices</a><a href="https://github.com/foreveryh/claude-code-cookbook" rel="noreferrer noopener" target="_blank" class="relative flex flex-row items-center gap-2 rounded-xl p-2 ps-(--sidebar-item-offset) text-start text-fd-muted-foreground [overflow-wrap:anywhere] [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 transition-colors hover:bg-fd-accent/50 hover:text-fd-accent-foreground/80 hover:transition-none" data-active="false"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide"><path d="M15 3h6v6"></path><path d="M10 14 21 3"></path><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path></svg>Cookbook</a><a href="https://claude.ai/code" rel="noreferrer noopener" target="_blank" class="relative flex flex-row items-center gap-2 rounded-xl p-2 ps-(--sidebar-item-offset) text-start text-fd-muted-foreground [overflow-wrap:anywhere] [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 transition-colors hover:bg-fd-accent/50 hover:text-fd-accent-foreground/80 hover:transition-none" data-active="false"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide"><path d="M15 3h6v6"></path><path d="M10 14 21 3"></path><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path></svg>Official Docs</a><a href="https://www.anthropic.com/learn/build-with-claude" rel="noreferrer noopener" target="_blank" class="relative flex flex-row items-center gap-2 rounded-xl p-2 ps-(--sidebar-item-offset) text-start text-fd-muted-foreground [overflow-wrap:anywhere] [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 transition-colors hover:bg-fd-accent/50 hover:text-fd-accent-foreground/80 hover:transition-none" data-active="false"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide"><path d="M15 3h6v6"></path><path d="M10 14 21 3"></path><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path></svg>Build with Claude</a><a href="https://x.com/Stephen4171127" rel="noreferrer noopener" target="_blank" class="relative flex flex-row items-center gap-2 rounded-xl p-2 ps-(--sidebar-item-offset) text-start text-fd-muted-foreground [overflow-wrap:anywhere] [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 transition-colors hover:bg-fd-accent/50 hover:text-fd-accent-foreground/80 hover:transition-none mb-4" data-active="false"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide"><path d="M15 3h6v6"></path><path d="M10 14 21 3"></path><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path></svg>Author</a><a data-active="false" class="relative flex flex-row items-center gap-2 rounded-xl p-2 ps-(--sidebar-item-offset) text-start text-fd-muted-foreground [overflow-wrap:anywhere] [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 transition-colors hover:bg-fd-accent/50 hover:text-fd-accent-foreground/80 hover:transition-none" href="/docs">首页</a><div data-state="closed"><a data-active="false" class="relative flex flex-row items-center gap-2 rounded-xl p-2 ps-(--sidebar-item-offset) text-start text-fd-muted-foreground [overflow-wrap:anywhere] [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 transition-colors hover:bg-fd-accent/50 hover:text-fd-accent-foreground/80 hover:transition-none w-full" href="/docs/en">Claude Code Documentation<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide ms-auto transition-transform -rotate-90" data-icon="true"><path d="m6 9 6 6 6-6"></path></svg></a><div data-state="closed" id="radix-_R_l6j9flb_" hidden="" class="overflow-hidden data-[state=closed]:animate-fd-collapsible-up data-[state=open]:animate-fd-collapsible-down relative **:data-[active=true]:before:content-[''] **:data-[active=true]:before:bg-fd-primary **:data-[active=true]:before:absolute **:data-[active=true]:before:w-px **:data-[active=true]:before:inset-y-2.5 **:data-[active=true]:before:start-2.5" style="--sidebar-item-offset: calc(var(--spacing) * 6);"></div></div><div data-state="open"><a data-active="false" class="relative flex flex-row items-center gap-2 rounded-xl p-2 ps-(--sidebar-item-offset) text-start text-fd-muted-foreground [overflow-wrap:anywhere] [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 transition-colors hover:bg-fd-accent/50 hover:text-fd-accent-foreground/80 hover:transition-none w-full" href="/docs/zh">Claude Code 文档中心<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide ms-auto transition-transform" data-icon="true"><path d="m6 9 6 6 6-6"></path></svg></a><div data-state="open" id="radix-_R_t6j9flb_" class="overflow-hidden data-[state=closed]:animate-fd-collapsible-up data-[state=open]:animate-fd-collapsible-down relative **:data-[active=true]:before:content-[''] **:data-[active=true]:before:bg-fd-primary **:data-[active=true]:before:absolute **:data-[active=true]:before:w-px **:data-[active=true]:before:inset-y-2.5 **:data-[active=true]:before:start-2.5" style="--sidebar-item-offset: calc(var(--spacing) * 6); transition-duration: 0s; animation-name: none; --radix-collapsible-content-height: 404px; --radix-collapsible-content-width: 254px;"><div class="absolute w-px inset-y-1 bg-fd-border start-2.5"></div><div data-state="open"><a data-active="false" class="relative flex flex-row items-center gap-2 rounded-xl p-2 ps-(--sidebar-item-offset) text-start text-fd-muted-foreground [overflow-wrap:anywhere] [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 transition-colors hover:bg-fd-accent/50 hover:text-fd-accent-foreground/80 hover:transition-none w-full" href="/docs/zh/advanced">高级<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide ms-auto transition-transform" data-icon="true"><path d="m6 9 6 6 6-6"></path></svg></a><div data-state="open" id="radix-_R_1lt6j9flb_" class="overflow-hidden data-[state=closed]:animate-fd-collapsible-up data-[state=open]:animate-fd-collapsible-down relative" style="--sidebar-item-offset: calc(var(--spacing) * 9); transition-duration: 0s; animation-name: none; --radix-collapsible-content-height: 188px; --radix-collapsible-content-width: 254px;"><a data-active="false" class="relative flex flex-row items-center gap-2 rounded-xl p-2 ps-(--sidebar-item-offset) text-start text-fd-muted-foreground [overflow-wrap:anywhere] [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 transition-colors hover:bg-fd-accent/50 hover:text-fd-accent-foreground/80 hover:transition-none" href="/docs/zh/advanced/claude-code-reverse-analysis">手把手教你逆向Claude Code：如何监控AI每一次'内心独白'？</a><a data-active="false" class="relative flex flex-row items-center gap-2 rounded-xl p-2 ps-(--sidebar-item-offset) text-start text-fd-muted-foreground [overflow-wrap:anywhere] [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 transition-colors hover:bg-fd-accent/50 hover:text-fd-accent-foreground/80 hover:transition-none" href="/docs/zh/advanced/compounding-engineering">复合式工程：构建自我改进的开发系统</a><a data-active="true" class="relative flex flex-row items-center gap-2 rounded-xl p-2 ps-(--sidebar-item-offset) text-start [overflow-wrap:anywhere] [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 bg-fd-primary/10 text-fd-primary" href="/docs/zh/advanced/decoding-claude-code-analysis">是什么让 Claude Code 如此出色（以及如何在你的智能体中重现这种魔力）!?</a></div></div><div data-state="closed"><a data-active="false" class="relative flex flex-row items-center gap-2 rounded-xl p-2 ps-(--sidebar-item-offset) text-start text-fd-muted-foreground [overflow-wrap:anywhere] [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 transition-colors hover:bg-fd-accent/50 hover:text-fd-accent-foreground/80 hover:transition-none w-full" href="/docs/zh/best-practices">最佳实践<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide ms-auto transition-transform -rotate-90" data-icon="true"><path d="m6 9 6 6 6-6"></path></svg></a><div data-state="closed" id="radix-_R_2lt6j9flb_" hidden="" class="overflow-hidden data-[state=closed]:animate-fd-collapsible-up data-[state=open]:animate-fd-collapsible-down relative" style="--sidebar-item-offset: calc(var(--spacing) * 9);"></div></div><div data-state="closed"><a data-active="false" class="relative flex flex-row items-center gap-2 rounded-xl p-2 ps-(--sidebar-item-offset) text-start text-fd-muted-foreground [overflow-wrap:anywhere] [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 transition-colors hover:bg-fd-accent/50 hover:text-fd-accent-foreground/80 hover:transition-none w-full" href="/docs/zh/community-tips">社区技巧<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide ms-auto transition-transform -rotate-90" data-icon="true"><path d="m6 9 6 6 6-6"></path></svg></a><div data-state="closed" id="radix-_R_3lt6j9flb_" hidden="" class="overflow-hidden data-[state=closed]:animate-fd-collapsible-up data-[state=open]:animate-fd-collapsible-down relative" style="--sidebar-item-offset: calc(var(--spacing) * 9);"></div></div><div data-state="closed"><a data-active="false" class="relative flex flex-row items-center gap-2 rounded-xl p-2 ps-(--sidebar-item-offset) text-start text-fd-muted-foreground [overflow-wrap:anywhere] [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 transition-colors hover:bg-fd-accent/50 hover:text-fd-accent-foreground/80 hover:transition-none w-full" href="/docs/zh/cursor">Cursor<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide ms-auto transition-transform -rotate-90" data-icon="true"><path d="m6 9 6 6 6-6"></path></svg></a><div data-state="closed" id="radix-_R_4lt6j9flb_" hidden="" class="overflow-hidden data-[state=closed]:animate-fd-collapsible-up data-[state=open]:animate-fd-collapsible-down relative" style="--sidebar-item-offset: calc(var(--spacing) * 9);"></div></div><div data-state="closed"><a data-active="false" class="relative flex flex-row items-center gap-2 rounded-xl p-2 ps-(--sidebar-item-offset) text-start text-fd-muted-foreground [overflow-wrap:anywhere] [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 transition-colors hover:bg-fd-accent/50 hover:text-fd-accent-foreground/80 hover:transition-none w-full" href="/docs/zh/sub-agents">子代理<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide ms-auto transition-transform -rotate-90" data-icon="true"><path d="m6 9 6 6 6-6"></path></svg></a><div data-state="closed" id="radix-_R_5lt6j9flb_" hidden="" class="overflow-hidden data-[state=closed]:animate-fd-collapsible-up data-[state=open]:animate-fd-collapsible-down relative" style="--sidebar-item-offset: calc(var(--spacing) * 9);"></div></div><div data-state="closed"><a data-active="false" class="relative flex flex-row items-center gap-2 rounded-xl p-2 ps-(--sidebar-item-offset) text-start text-fd-muted-foreground [overflow-wrap:anywhere] [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 transition-colors hover:bg-fd-accent/50 hover:text-fd-accent-foreground/80 hover:transition-none w-full" href="/docs/zh/tools">工具<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide ms-auto transition-transform -rotate-90" data-icon="true"><path d="m6 9 6 6 6-6"></path></svg></a><div data-state="closed" id="radix-_R_6lt6j9flb_" hidden="" class="overflow-hidden data-[state=closed]:animate-fd-collapsible-up data-[state=open]:animate-fd-collapsible-down relative" style="--sidebar-item-offset: calc(var(--spacing) * 9);"></div></div></div></div></div></div></div><div data-fd-if-empty="_R_3j9flb_" class="flex flex-col border-t px-4 py-3"><div class="flex text-fd-muted-foreground items-center justify-end empty:hidden"><button class="inline-flex items-center rounded-full border p-0 ms-1.5" aria-label="Toggle Theme" data-theme-toggle=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-6.5 rounded-full p-1.5 bg-fd-accent text-fd-accent-foreground"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-6.5 rounded-full p-1.5 text-fd-muted-foreground"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg></button></div></div></aside><div id="nd-page" class="flex flex-1 mx-auto w-full" style="padding-top:calc(var(--fd-nav-height) + var(--fd-tocnav-height));max-width:min(var(--fd-page-width),calc(var(--fd-layout-width) - var(--fd-sidebar-width)))"><article class="flex min-w-0 w-full flex-col gap-4 px-4 pt-8 md:px-6 md:mx-auto xl:pt-12 xl:px-12"><div class="flex items-center gap-1.5 text-sm text-fd-muted-foreground"><a class="truncate transition-opacity hover:opacity-80" href="/docs/zh">Claude Code 文档中心</a><span class="text-fd-foreground/30">/</span><a class="truncate text-fd-primary font-medium transition-opacity hover:opacity-80" href="/docs/zh/advanced">高级</a></div><h1 class="text-3xl font-semibold">是什么让 Claude Code 如此出色（以及如何在你的智能体中重现这种魔力）!?</h1><p class="mb-8 text-lg text-fd-muted-foreground">深入分析 Claude Code 的核心设计原理，揭示如何构建出色的大语言模型编程代理</p><div class="prose"><h1 class="flex scroll-m-28 flex-row items-center gap-2" id="是什么让-claude-code-如此出色以及如何在你的智能体中重现这种魔力"><a data-card="" href="#是什么让-claude-code-如此出色以及如何在你的智能体中重现这种魔力" class="peer">是什么让 Claude Code 如此出色（以及如何在你的智能体中重现这种魔力）!?</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h1>
<p>Claude Code 是我迄今为止使用过的最令人愉悦的 AI 智能体（AI agent）/工作流程。它不仅让有针对性的编辑或随意编码一次性工具变得不那么烦人，使用 Claude Code 还让我感到快乐。它有足够的自主性来做有趣的事情，同时不会像其他一些工具那样产生令人不安的失控感。当然，大部分繁重的工作是由新的 Claude 4 模型完成的（特别是交织思维 interleaved thinking）。但我发现，即使使用相同的底层模型，Claude Code 相比 Cursor 或 Github Copilot 智能体客观上使用起来更不令人烦恼！是什么让它如此出色？如果你正在阅读这篇文章并表示赞同，我将尝试提供一些答案。</p>
<p><strong>注意</strong>：这不是一篇包含 Claude Code 架构详细分析的博客文章（网上已经有一些不错的文章了）。这篇博客文章旨在成为构建令人愉快的大语言模型（LLM）智能体的指南，基于我过去几个月使用和调试 Claude Code 的经验（以及我们拦截和分析的所有日志）。你可以在<a href="https://minusx.ai/blog/decoding-claude-code/#appendix" rel="noreferrer noopener" target="_blank">附录部分</a>找到<a href="https://minusx.ai/blog/decoding-claude-code/#appendix" rel="noreferrer noopener" target="_blank">提示词</a>和<a href="https://minusx.ai/blog/decoding-claude-code/#appendix" rel="noreferrer noopener" target="_blank">工具</a>。这篇文章大约 2000 字，所以请做好准备！如果你想要快速了解要点，<a href="https://minusx.ai/blog/decoding-claude-code/#how-to-build-a-claude-code-like-agent-tldr" rel="noreferrer noopener" target="_blank">TL;DR</a> 部分是一个不错的起点。</p>
<p><img alt="提示词" loading="lazy" width="1570" height="529" decoding="async" data-nimg="1" class="rounded-lg" style="color: transparent;" sizes="(max-width: 768px) 100vw, (max-width: 1200px) 70vw, 900px" srcset="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fprompts.613eb0e3.png&amp;w=640&amp;q=75 640w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fprompts.613eb0e3.png&amp;w=750&amp;q=75 750w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fprompts.613eb0e3.png&amp;w=828&amp;q=75 828w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fprompts.613eb0e3.png&amp;w=1080&amp;q=75 1080w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fprompts.613eb0e3.png&amp;w=1200&amp;q=75 1200w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fprompts.613eb0e3.png&amp;w=1920&amp;q=75 1920w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fprompts.613eb0e3.png&amp;w=2048&amp;q=75 2048w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fprompts.613eb0e3.png&amp;w=3840&amp;q=75 3840w" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fprompts.613eb0e3.png&amp;w=3840&amp;q=75"></p>
<p>你可以清楚地看到不同的 Claude Code 更新。</p>
<p>Claude Code（CC）使用起来感觉很棒，因为它<em>就是能正常工作</em>。CC 是在对大语言模型擅长什么和不擅长什么有根本理解的基础上精心制作的。它的提示词和工具弥补了模型的愚蠢之处，帮助它在其擅长的领域发光发热。控制循环极其简单易懂，调试起来毫不费力。</p>
<p>我们在 MinusX 一推出就开始使用 CC。为了一窥其内部运作，<a href="https://x.com/ppsreejith_" rel="noreferrer noopener" target="_blank">Sreejith</a> 编写了一个记录器，拦截并记录每个网络请求。以下分析基于我过去几个月的广泛使用。<strong>这篇文章试图回答这个问题——"是什么让 Claude Code 如此出色，你如何在自己的基于聊天的大语言模型智能体中提供类似 CC 的体验？"</strong> 我们已经将其中大部分内容融入到 MinusX 中，我也很兴奋地想看到你也这样做！</p>
<h2 class="flex scroll-m-28 flex-row items-center gap-2" id="如何构建类似-claude-code-的智能体tldr"><a data-card="" href="#如何构建类似-claude-code-的智能体tldr" class="peer">如何构建类似 Claude Code 的智能体：TL;DR</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>如果只能从中获得一个收获的话，那就是这个——<strong>保持简单，愚蠢</strong>（Keep Things Simple, Dummy）。大语言模型本身就足够难以调试和评估了。你引入的任何额外复杂性（多智能体、智能体交接或复杂的RAG检索增强生成算法）只会让调试难度增加10倍。如果这样一个脆弱的系统真的能工作，你会害怕日后对它进行大幅修改。所以，把所有东西放在一个文件里，避免过多的样板脚手架，并且至少要把它们全部重写几次 :)</p>
<p>以下是从 Claude Code 中总结出的，可以应用到你自己系统中的主要收获。</p>
<h3 class="flex scroll-m-28 flex-row items-center gap-2" id="1-控制循环"><a data-card="" href="#1-控制循环" class="peer">1. 控制循环</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h3>
<ul>
<li>1.1 <a href="#11-%E4%BF%9D%E6%8C%81%E5%8D%95%E4%B8%80%E4%B8%BB%E5%BE%AA%E7%8E%AF">保持一个主循环（最多一个分支）和一个消息历史记录</a></li>
<li>1.2 <a href="#12-%E4%B8%BA%E4%B8%80%E5%88%87%E4%BD%BF%E7%94%A8%E6%9B%B4%E5%B0%8F%E7%9A%84%E6%A8%A1%E5%9E%8B">大量使用更小的模型。所有事情。都要。用。</a></li>
</ul>
<h3 class="flex scroll-m-28 flex-row items-center gap-2" id="2-提示词"><a data-card="" href="#2-提示词" class="peer">2. 提示词</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h3>
<ul>
<li>2.1 <a href="#21-%E4%BD%BF%E7%94%A8-claudemd-%E5%8D%8F%E4%BD%9C%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E4%B8%8A%E4%B8%8B%E6%96%87%E5%92%8C%E5%81%8F%E5%A5%BD">使用 claude.md 模式协作和记住用户偏好</a></li>
<li>2.2 <a href="#22-%E7%89%B9%E6%AE%8A%E7%9A%84-xml-%E6%A0%87%E7%AD%BEmarkdown-%E5%92%8C%E5%A4%A7%E9%87%8F%E7%A4%BA%E4%BE%8B">使用特殊的 XML 标签、Markdown 和大量示例</a></li>
</ul>
<h3 class="flex scroll-m-28 flex-row items-center gap-2" id="3-工具"><a data-card="" href="#3-工具" class="peer">3. 工具</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h3>
<ul>
<li>3.1 <a href="#31-llm-%E6%90%9C%E7%B4%A2--%E5%9F%BA%E4%BA%8E-rag-%E7%9A%84%E6%90%9C%E7%B4%A2">LLM 搜索 &gt;&gt;&gt; 基于 RAG 的搜索</a></li>
<li>3.2 <a href="#32-%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E5%A5%BD%E7%9A%84%E5%B7%A5%E5%85%B7%E4%BD%8E%E7%BA%A7vs%E9%AB%98%E7%BA%A7%E5%B7%A5%E5%85%B7">如何设计好的工具？（高级vs低级工具）</a></li>
<li>3.3 <a href="#33-%E8%AE%A9%E6%99%BA%E8%83%BD%E4%BD%93%E7%AE%A1%E7%90%86%E5%BE%85%E5%8A%9E%E4%BA%8B%E9%A1%B9%E5%88%97%E8%A1%A8">让你的智能体管理自己的待办事项列表</a></li>
</ul>
<h3 class="flex scroll-m-28 flex-row items-center gap-2" id="4-可控性"><a data-card="" href="#4-可控性" class="peer">4. 可控性</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h3>
<ul>
<li>4.1 <a href="#41-%E8%AF%AD%E8%B0%83%E5%92%8C%E9%A3%8E%E6%A0%BC">语调和风格</a></li>
<li>4.2 <a href="#42-%E8%AF%B7%E6%B3%A8%E6%84%8F%E8%BF%99%E5%BE%88%E9%87%8D%E8%A6%81%E4%B8%8D%E5%B9%B8%E4%BB%8D%E7%84%B6%E6%98%AF%E6%9C%80%E5%85%88%E8%BF%9B%E7%9A%84%E6%96%B9%E6%B3%95">"<strong>请注意这很重要</strong>"不幸仍然是最先进的方法</a></li>
<li>4.3 <a href="#43-%E7%BC%96%E5%86%99%E7%AE%97%E6%B3%95%E5%8C%85%E5%90%AB%E5%90%AF%E5%8F%91%E5%BC%8F%E6%96%B9%E6%B3%95%E5%92%8C%E7%A4%BA%E4%BE%8B">编写算法，包含启发式方法和示例</a></li>
</ul>
<blockquote>
<p>Claude Code 在每个关键节点都选择了架构简单性——一个主循环、简单搜索、简单待办事项列表等。抵制过度工程化的冲动，为模型构建良好的运行环境，让它自由发挥！这是否又是端到端自动驾驶的重演？苦涩的教训？</p>
</blockquote>
<hr>
<h2 class="flex scroll-m-28 flex-row items-center gap-2" id="1-控制循环设计"><a data-card="" href="#1-控制循环设计" class="peer">1. 控制循环设计</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<h3 class="flex scroll-m-28 flex-row items-center gap-2" id="11-保持单一主循环"><a data-card="" href="#11-保持单一主循环" class="peer">1.1 保持单一主循环</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h3>
<p><strong>可调试性 &gt;&gt;&gt; 复杂的手工调优多智能体语言链图节点混合体</strong></p>
<p>尽管多智能体系统正大行其道，Claude Code 只有一个主线程。它确实会定期使用几种不同类型的提示来总结 git 历史记录、将消息历史记录合并为一条消息或生成一些有趣的用户体验元素。但除此之外，它维护的是一个扁平的消息列表。它处理分层任务的有趣方式是将自身生成为子智能体，但这个子智能体没有能力生成更多子智能体。最多只有一个分支，其结果作为"工具响应"添加到主消息历史记录中。</p>
<p>如果问题足够简单，主循环就通过迭代工具调用来处理它。但如果有一个或多个复杂的任务，主智能体会创建自身的克隆。最大单分支和待办事项列表的组合确保智能体能够将问题分解为子问题，同时也保持对最终期望结果的关注。</p>
<p>我高度怀疑你的应用需要多智能体系统。每增加一层抽象，你就让系统更难调试，更重要的是，你偏离了通用模型改进轨迹。</p>
<p><img alt="控制循环" loading="lazy" width="1142" height="805" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" sizes="(max-width: 768px) 100vw, (max-width: 1200px) 70vw, 900px" srcset="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fcontrol_loop.a9497504.gif&amp;w=640&amp;q=75 640w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fcontrol_loop.a9497504.gif&amp;w=750&amp;q=75 750w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fcontrol_loop.a9497504.gif&amp;w=828&amp;q=75 828w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fcontrol_loop.a9497504.gif&amp;w=1080&amp;q=75 1080w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fcontrol_loop.a9497504.gif&amp;w=1200&amp;q=75 1200w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fcontrol_loop.a9497504.gif&amp;w=1920&amp;q=75 1920w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fcontrol_loop.a9497504.gif&amp;w=2048&amp;q=75 2048w, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fcontrol_loop.a9497504.gif&amp;w=3840&amp;q=75 3840w" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fcontrol_loop.a9497504.gif&amp;w=3840&amp;q=75"></p>
<h3 class="flex scroll-m-28 flex-row items-center gap-2" id="12-为一切使用更小的模型"><a data-card="" href="#12-为一切使用更小的模型" class="peer">1.2 为<em>一切</em>使用更小的模型</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h3>
<h2 class="flex scroll-m-28 flex-row items-center gap-2" id="2-提示词-1"><a data-card="" href="#2-提示词-1" class="peer">2. 提示词</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>Claude Code 有极其精细的提示词，充满了启发式方法、示例和重要（咗咕）提醒。系统提示大约有 2800 个 token 长，而工具部分占了高达 9400 个 token。用户提示总是包含 claude.md 文件，通常可以再增加 1000-2000 个 token。系统提示包含关于语调、风格、主动性、任务管理、工具使用政策和执行任务的部分。它还包含日期、当前工作目录、平台和操作系统信息以及最近的提交记录。</p>
<p><a href="https://minusx.ai/blog/decoding-claude-code/#appendix" rel="noreferrer noopener" target="_blank"><strong>去阅读完整的提示词</strong></a>！</p>
<h3 class="flex scroll-m-28 flex-row items-center gap-2" id="21-使用-claudemd-协作处理用户上下文和偏好"><a data-card="" href="#21-使用-claudemd-协作处理用户上下文和偏好" class="peer">2.1 使用 claude.md 协作处理用户上下文和偏好</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h3>
<p>大多数编码智能体创作者已经达成共识的主要模式之一是上下文文件（也就是 Cursor Rules / claude.md / agent.md）。Claude Code 在有和没有 claude.md 情况下的表现差别天壤之别。这是开发者传达无法从代码库推断出的上下文并成文化所有严格偏好的好方法。例如，你可以强制大语言模型跳过某些文件夹，或使用特定的库。CC 在每个用户请求中都会发送 claude.md 的完整内容。</p>
<p>我们最近在 MinusX 中推出了 <a href="https://minusx.ai/blog/memory/" rel="noreferrer noopener" target="_blank">minusx.md</a>，它正在快速成为我们智能体成文化用户和团队偏好的事实上的上下文文件。</p>
<h3 class="flex scroll-m-28 flex-row items-center gap-2" id="22-特殊的-xml-标签markdown-和大量示例"><a data-card="" href="#22-特殊的-xml-标签markdown-和大量示例" class="peer">2.2 特殊的 XML 标签、Markdown 和大量示例</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h3>
<p>XML 标签和 Markdown 是结构化提示的两种方式，这已经得到相当程度的认可。CC 广泛使用这两种方式。以下是 Claude Code 中几个值得注意的 XML 标签：</p>
<ul>
<li><code>&lt;system-reminder&gt;</code>：这用于在许多提示部分的末尾，提醒大语言模型那些它可能否则会忘记的事情。例如：</li>
</ul>
<figure dir="ltr" class="my-4 rounded-xl bg-fd-card p-1 shiki relative border outline-none not-prose overflow-hidden text-sm shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><div class="empty:hidden absolute top-1 right-1 z-2 bg-fd-card rounded-bl-lg border-l border-b text-fd-muted-foreground"><button type="button" class="inline-flex items-center justify-center rounded-md p-2 text-sm font-medium transition-colors duration-100 disabled:pointer-events-none disabled:opacity-50 focus-visible:outline-none hover:bg-fd-accent hover:text-fd-accent-foreground [&amp;_svg]:size-3.5" aria-label="Copy Text"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div><div class="bg-fd-secondary rounded-lg border text-[13px] py-3.5 overflow-auto max-h-[600px] fd-scroll-container" style="--padding-right:calc(var(--spacing) * 8)"><pre class="min-w-full w-max *:flex *:flex-col"><code><span class="line"><span>&lt;system-reminder&gt;这是一个提醒，你的待办事项列表目前为空。不要明确告诉用户这一点，因为他们已经知道了。如果你正在处理的任务可以从待办事项列表中受益，请使用 TodoWrite 工具创建一个。如果不需要，请随意忽略。再次强调，不要向用户提及这条消息。&lt;/system-reminder&gt;</span></span></code></pre></div></figure>
<ul>
<li><code>&lt;good-example&gt;</code>、<code>&lt;bad-example&gt;</code>：这些用于成文化启发式方法。当在十字路口有多个看似合理的路径/工具调用可供模型选择时，它们特别有用。示例可以用来对比情况，非常清楚地说明哪种路径更优选。例如：</li>
</ul>
<figure dir="ltr" class="my-4 rounded-xl bg-fd-card p-1 shiki relative border outline-none not-prose overflow-hidden text-sm shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><div class="empty:hidden absolute top-1 right-1 z-2 bg-fd-card rounded-bl-lg border-l border-b text-fd-muted-foreground"><button type="button" class="inline-flex items-center justify-center rounded-md p-2 text-sm font-medium transition-colors duration-100 disabled:pointer-events-none disabled:opacity-50 focus-visible:outline-none hover:bg-fd-accent hover:text-fd-accent-foreground [&amp;_svg]:size-3.5" aria-label="Copy Text"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div><div class="bg-fd-secondary rounded-lg border text-[13px] py-3.5 overflow-auto max-h-[600px] fd-scroll-container" style="--padding-right:calc(var(--spacing) * 8)"><pre class="min-w-full w-max *:flex *:flex-col"><code><span class="line"><span>尽量在整个会话期间通过使用绝对路径和避免使用 `cd` 来维持你的当前工作目录。如果用户明确要求，你可以使用 `cd`。</span></span>
<span class="line"><span>&lt;good-example&gt;</span></span>
<span class="line"><span>pytest /foo/bar/tests  </span></span>
<span class="line"><span>&lt;/good-example&gt;</span></span>
<span class="line"><span>&lt;bad-example&gt;</span></span>
<span class="line"><span>cd /foo/bar &amp;&amp; pytest tests</span></span>
<span class="line"><span>&lt;/bad-example&gt;</span></span></code></pre></div></figure>
<p>CC 还使用 markdown 在系统提示中清晰地划分各个部分。markdown 标题的例子包括：</p>
<h2 class="flex scroll-m-28 flex-row items-center gap-2" id="3-工具-1"><a data-card="" href="#3-工具-1" class="peer">3. 工具</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p><a href="https://minusx.ai/blog/decoding-claude-code/#appendix" rel="noreferrer noopener" target="_blank"><strong>去阅读完整的工具提示</strong></a> —— 它有高达 9400 个 token 长！</p>
<h3 class="flex scroll-m-28 flex-row items-center gap-2" id="31-llm-搜索--基于-rag-的搜索"><a data-card="" href="#31-llm-搜索--基于-rag-的搜索" class="peer">3.1 LLM 搜索 &gt;&gt;&gt; 基于 RAG 的搜索</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h3>
<p>Claude Code 与其他流行编码智能体的一个重大差异在于它拒绝了 RAG检索增强生成。Claude Code 搜索你的代码库的方式就像你一样，使用非常复杂的 <code>ripgrep</code>、<code>jq</code> 和 <code>find</code> 命令。由于大语言模型非常善于理解代码，它可以使用复杂的正则表达式找到几乎任何它认为相关的代码块。有时它会最终用较小的模型读取整个文件。</p>
<p>RAG 在理论上听起来是个好主意，但它引入了新的（更重要的是，隐藏的）故障模式。使用什么相似性函数？什么重排序器？如何分块代码？对于大型 JSON 或日志文件怎么办？使用 LLM 搜索，它只是看 json 文件的 10 行来理解其结构。如果它想要，就再看 10 行——就像你一样。最重要的是，这是可强化学习的——这是大型实验室已经在处理的事情。模型做大部分繁重的工作——它应该这样，这极大减少了智能体中移动部件的数量。同时，让两个复杂的智能系统这样连接起来就是很丑陋的。我最近跟一个朋友开玩笑说，这是大语言模型时代的相机 vs 激光雷达之争，我只是半开玩笑。</p>
<h3 class="flex scroll-m-28 flex-row items-center gap-2" id="32-如何设计好的工具低级vs高级工具"><a data-card="" href="#32-如何设计好的工具低级vs高级工具" class="peer">3.2 如何设计好的工具？（低级vs高级工具）</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h3>
<p>这个问题让任何正在构庻大语言模型智能体的人彻夜难眠。你应该给模型通用任务（像有意义的动作）还是应该是低级的（像打字和点击和 bash）？答案是这取决于具体情况（而且你应该两者都用）。</p>
<p>Claude Code 有低级（Bash、Read、Write）、中级（Edit、Grep、Glob）和高级工具（Task、WebFetch、exit_plan_mode）。CC 可以使用 bash，那为什么要单独给一个 Grep 工具？这里真正的权衡在于你期望你的智能体使用这个工具的频率 vs 智能体使用该工具的准确性。CC 使用 grep 和 glob 非常频繁，所以把它们做成单独的工具是有意义的，但同时，它也可以为特殊场景编写通用的 bash 命令。</p>
<p>同样，还有甚至更高级的工具，如 WebFetch 或 'mcp__ide__getDiagnostics'，它们在功能上非常确定。这可以让大语言模型免于做多个低级的点击和打字，并保持在正轨上。帮帮这个可怜的模型吧！工具描述有精细的提示，带有大量示例。系统提示包含关于“何时使用工具”或如何在可以做相同任务的两个工具之间进行选择的信息。</p>
<p><strong>Claude Code 中的工具：</strong></p>
<ul>
<li><a href="https://minusx.ai/blog/decoding-claude-code/#appendix" rel="noreferrer noopener" target="_blank">Task</a></li>
<li><a href="https://minusx.ai/blog/decoding-claude-code/#appendix" rel="noreferrer noopener" target="_blank">Bash</a></li>
<li><a href="https://minusx.ai/blog/decoding-claude-code/#appendix" rel="noreferrer noopener" target="_blank">Glob</a></li>
<li><a href="https://minusx.ai/blog/decoding-claude-code/#appendix" rel="noreferrer noopener" target="_blank">Grep</a></li>
<li><a href="https://minusx.ai/blog/decoding-claude-code/#appendix" rel="noreferrer noopener" target="_blank">LS</a></li>
<li><a href="https://minusx.ai/blog/decoding-claude-code/#appendix" rel="noreferrer noopener" target="_blank">ExitPlanMode</a></li>
<li><a href="https://minusx.ai/blog/decoding-claude-code/#appendix" rel="noreferrer noopener" target="_blank">Read</a></li>
<li><a href="https://minusx.ai/blog/decoding-claude-code/" rel="noreferrer noopener" target="_blank">Edit</a></li>
<li><a href="https://minusx.ai/blog/decoding-claude-code/#appendix" rel="noreferrer noopener" target="_blank">MultiEdit</a></li>
<li><a href="https://minusx.ai/blog/decoding-claude-code/#appendix" rel="noreferrer noopener" target="_blank">Write</a></li>
<li><a href="https://minusx.ai/blog/decoding-claude-code/#appendix" rel="noreferrer noopener" target="_blank">NotebookEdit</a></li>
<li><a href="https://minusx.ai/blog/decoding-claude-code/#appendix" rel="noreferrer noopener" target="_blank">WebFetch</a></li>
<li><a href="https://minusx.ai/blog/decoding-claude-code/#appendix" rel="noreferrer noopener" target="_blank">TodoWrite</a></li>
<li><a href="https://minusx.ai/blog/decoding-claude-code/#appendix" rel="noreferrer noopener" target="_blank">WebSearch</a></li>
<li><a href="https://minusx.ai/blog/decoding-claude-code/" rel="noreferrer noopener" target="_blank">mcp__ide__getDiagnostics</a></li>
<li><a href="https://minusx.ai/blog/decoding-claude-code/" rel="noreferrer noopener" target="_blank">mcp__ide__executeCode</a></li>
</ul>
<h3 class="flex scroll-m-28 flex-row items-center gap-2" id="33-让智能体管理待办事项列表"><a data-card="" href="#33-让智能体管理待办事项列表" class="peer">3.3 让智能体管理待办事项列表</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h3>
<p>这是个好主意的原因很多。上下文腐烂是长期运行的大语言模型智能体的一个常见问题。它们热情洋溢地开始解决一个困难的问题，但随着时间的推移迷失了方向，并退化为垃圾。目前的智能体设计有几种方式来解决这个问题。许多智能体尝试了明确的待办事项（一个模型生成待办事项，另一个模型实现它们）或多智能体交接 + 验证（PRD/PM 智能体 -&gt; 实现者智能体 -&gt; QA 智能体）。</p>
<h2 class="flex scroll-m-28 flex-row items-center gap-2" id="4-可控性-1"><a data-card="" href="#4-可控性-1" class="peer">4. 可控性</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<h3 class="flex scroll-m-28 flex-row items-center gap-2" id="41-语调和风格"><a data-card="" href="#41-语调和风格" class="peer">4.1 语调和风格</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h3>
<p>CC 明确尝试控制智能体的美学行为。系统提示中有关于语调、风格和主动性的部分——充满了指导和示例。这就是为什么 Claude Code 在其评论和热心程度上“感觉”很有品味。我建议直接将其中大部分内容原样复制到你的应用中。</p>
<figure dir="ltr" class="my-4 rounded-xl bg-fd-card p-1 shiki relative border outline-none not-prose overflow-hidden text-sm shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><div class="empty:hidden absolute top-1 right-1 z-2 bg-fd-card rounded-bl-lg border-l border-b text-fd-muted-foreground"><button type="button" class="inline-flex items-center justify-center rounded-md p-2 text-sm font-medium transition-colors duration-100 disabled:pointer-events-none disabled:opacity-50 focus-visible:outline-none hover:bg-fd-accent hover:text-fd-accent-foreground [&amp;_svg]:size-3.5" aria-label="Copy Text"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div><div class="bg-fd-secondary rounded-lg border text-[13px] py-3.5 overflow-auto max-h-[600px] fd-scroll-container" style="--padding-right:calc(var(--spacing) * 8)"><pre class="min-w-full w-max *:flex *:flex-col"><code><span class="line"><span># 一些语调和风格的示例</span></span>
<span class="line"><span>- 重要：除非用户要求，否则不应该用不必要的开场白或结尾（如解释你的代码或总结你的行动）来回答。</span></span>
<span class="line"><span>除非用户要求，否则不要添加额外的代码解释总结。</span></span>
<span class="line"><span></span></span>
<span class="line"><span>- 如果你不能或不愿意帮助用户做某事，请不要说为什么或可能导致什么，因为这会显得说教和烦人。</span></span>
<span class="line"><span></span></span>
<span class="line"><span>- 只有在用户明确要求时才使用表情符号。除非被要求，否则在所有交流中避免使用表情符号。</span></span></code></pre></div></figure>
<h3 class="flex scroll-m-28 flex-row items-center gap-2" id="42-请注意这很重要不幸仍然是最先进的方法"><a data-card="" href="#42-请注意这很重要不幸仍然是最先进的方法" class="peer">4.2 "请注意这很重要"不幸仍然是最先进的方法</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h3>
<p>不幸的是，在要求模型不做某事时，CC 也没有更好的方法。IMPORTANT、VERY IMPORTANT、NEVER 和 ALWAYS 似乎是将模型从雷区引开的最佳方式。我期望模型在未来能变得更可控，并避免这种丑陋的做法。但现在，CC 大量使用这种方式，你也应该这样做。一些例子：</p>
<figure dir="ltr" class="my-4 rounded-xl bg-fd-card p-1 shiki relative border outline-none not-prose overflow-hidden text-sm shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><div class="empty:hidden absolute top-1 right-1 z-2 bg-fd-card rounded-bl-lg border-l border-b text-fd-muted-foreground"><button type="button" class="inline-flex items-center justify-center rounded-md p-2 text-sm font-medium transition-colors duration-100 disabled:pointer-events-none disabled:opacity-50 focus-visible:outline-none hover:bg-fd-accent hover:text-fd-accent-foreground [&amp;_svg]:size-3.5" aria-label="Copy Text"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div><div class="bg-fd-secondary rounded-lg border text-[13px] py-3.5 overflow-auto max-h-[600px] fd-scroll-container" style="--padding-right:calc(var(--spacing) * 8)"><pre class="min-w-full w-max *:flex *:flex-col"><code><span class="line"><span>- 重要：除非被要求，否则不要添加***任何***注释</span></span>
<span class="line"><span></span></span>
<span class="line"><span>- 非常重要：你必须避免使用像 `find` 和 `grep` 这样的搜索命令。相反，请使用 Grep、Glob 或 Task 来搜索。你必须避免使用像 `cat`、`head`、`tail` 和 `ls` 这样的读取工具，并使用 Read 和 LS 来读取文件。</span></span>
<span class="line"><span>  - 如果你*仍然*需要运行 `grep`，停下。总是先使用 `rg` 的 ripgrep</span></span>
<span class="line"><span></span></span>
<span class="line"><span>- 重要：你绝不能为用户生成或猜测 URL，除非你确信这些 URL 是为了帮助用户进行编程。你可以使用用户在其消息或本地文件中提供的 URL。</span></span></code></pre></div></figure>
<h3 class="flex scroll-m-28 flex-row items-center gap-2" id="43-编写算法包含启发式方法和示例"><a data-card="" href="#43-编写算法包含启发式方法和示例" class="peer">4.3 编写算法（包含启发式方法和示例）</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h3>
<p>识别大语言模型需要执行的最重要任务并为其编写算法是极其重要的。尝试角色扮演为大语言模型并通过示例工作，识别所有决策点并明确地写出它们。如果能以流程图的形式就更好了。这有助于结构化决策制定，并帮助大语言模型遵循指示。一个绝对要避免的事情是一大堆“该做和不该做”的汤。它们更难跟踪，并保持相互排斥。如果你的提示有几千个 token 长，你就不可避免地会有相互冲突的“该做和不该做”。在这种情况下，大语言模型变得极其脆弱，并且无法融入新的用例。</p>
<p>Claude Code 系统提示中的<code>任务管理</code>、<code>执行任务</code>和<code>工具使用政策</code>部分清楚地阐述了要遵循的算法。这也是添加大量启发式方法和大语言模型可能遇到的各种场景示例的部分。</p>
<h2 class="flex scroll-m-28 flex-row items-center gap-2" id="额外内容为什么要关注大型实验室的提示"><a data-card="" href="#额外内容为什么要关注大型实验室的提示" class="peer">额外内容：为什么要关注大型实验室的提示？</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>在引导大语言模型方面的很多努力都在尝试逆向工程它们的后训练 / 人类反馈强化学习（RLHF）数据分布。你应该使用 JSON 还是 XML？工具描述应该在系统提示中还是只在工具中？你的应用的当前状态怎么办？看看它们在自己的应用中做什么并用它来指导你的应用是有帮助的。Claude Code 的设计非常有主见，这有助于形成你自己的观点。</p>
<h2 class="flex scroll-m-28 flex-row items-center gap-2" id="结论"><a data-card="" href="#结论" class="peer">结论</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>主要的收获，再次强调，就是保持简单。极端脚手架框架会对你有害而无益。Claude Code 真的让我相信一个“智能体”可以既简单又极其强大。我们已经将其中许多经验融入到 MinusX 中，并正在继续融入更多。</p>
<p>如果你有兴趣将你自己的大语言模型智能体“Claude Code 化”，我很乐意聊聊——在 <a href="https://x.com/nuwandavek" rel="noreferrer noopener" target="_blank">twitter</a> 上联系我！如果你想要为你的 Metabase 获得可训练的类似 Claude Code 的数据智能体，请查看 <a href="https://minusx.ai/" rel="noreferrer noopener" target="_blank">MinusX</a> 或在<a href="https://minusx.ai/demo" rel="noreferrer noopener" target="_blank">这里</a>与我预约演示。快乐（Claude）编程！</p>
<hr>
<h2 class="flex scroll-m-28 flex-row items-center gap-2" id="附录"><a data-card="" href="#附录" class="peer">附录</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p><em>附录内容包含完整的提示词和工具详细信息，可在<a href="https://minusx.ai/blog/decoding-claude-code/#appendix" rel="noreferrer noopener" target="_blank">MinusX 博客原文</a>中查看。</em></p>
<ul>
<li><strong>提供清晰的决策框架</strong>而非规则列表</li>
</ul>
<h2 class="flex scroll-m-28 flex-row items-center gap-2" id="-为什么研究大实验室提示"><a data-card="" href="#-为什么研究大实验室提示" class="peer">💡 为什么研究大实验室提示？</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>理解像 Anthropic 这样的公司如何构建其代理提供了以下洞察：</p>
<ul>
<li><strong>后训练数据分布</strong>他们期望的</li>
<li><strong>最佳格式</strong>（JSON vs XML）</li>
<li><strong>提示放置策略</strong>（系统 vs 工具）</li>
<li><strong>状态管理方法</strong></li>
</ul>
<p>Claude Code 的主观设计反映了关于什么最适合其模型的内部知识。</p>
<h2 class="flex scroll-m-28 flex-row items-center gap-2" id="-实施策略"><a data-card="" href="#-实施策略" class="peer">🚀 实施策略</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<h3 class="flex scroll-m-28 flex-row items-center gap-2" id="第一阶段核心架构"><a data-card="" href="#第一阶段核心架构" class="peer">第一阶段：核心架构</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h3>
<ol>
<li>实施具有子代理能力的单主循环</li>
<li>添加上下文文件系统（您的 claude.md 等价物）</li>
<li>创建智能模型选择（在适当的地方使用更便宜的模型）</li>
</ol>
<h3 class="flex scroll-m-28 flex-row items-center gap-2" id="第二阶段高级功能"><a data-card="" href="#第二阶段高级功能" class="peer">第二阶段：高级功能</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h3>
<ol>
<li>构建 LLM 原生搜索系统</li>
<li>实施代理管理的待办事项列表</li>
<li>添加带有 XML 标签的全面提示工程</li>
</ol>
<h3 class="flex scroll-m-28 flex-row items-center gap-2" id="第三阶段优化"><a data-card="" href="#第三阶段优化" class="peer">第三阶段：优化</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h3>
<ol>
<li>设计语调和风格响应</li>
<li>添加大量示例和启发式方法</li>
<li>创建清晰的算法决策框架</li>
</ol>
<h2 class="flex scroll-m-28 flex-row items-center gap-2" id="-更大的图景"><a data-card="" href="#-更大的图景" class="peer">🎯 更大的图景</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>Claude Code 代表了从过度工程化的代理框架向<strong>简单的、以模型为中心的设计</strong>的<strong>范式转变</strong>。关键洞察是模型本身应该承担重任，工具设计应该放大其优势，而不是补偿根本限制。</p>
<p>这种方法是：</p>
<ul>
<li><strong>比复杂的多代理系统更可调试</strong></li>
<li><strong>与模型改进轨迹更一致</strong></li>
<li><strong>随着模型演进更可维护</strong></li>
<li><strong>在日常使用中更用户友好</strong></li>
</ul>
<h2 class="flex scroll-m-28 flex-row items-center gap-2" id="-未来影响"><a data-card="" href="#-未来影响" class="peer">🔮 未来影响</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-3.5 shrink-0 text-fd-muted-foreground opacity-0 transition-opacity peer-hover:opacity-100" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>随着 LLM 变得更有能力，Claude Code 背后的原则变得更加相关：</p>
<ul>
<li><strong>简洁性比复杂性扩展性更好</strong></li>
<li><strong>以模型为中心的设计</strong>受益于通用改进</li>
<li><strong>清晰的接口</strong>无论底层能力如何都保持价值</li>
<li><strong>用户体验工程</strong>成为关键差异化因素</li>
</ul>
<p>接受这些原则的团队和产品将构建更令人愉悦、可维护和有效的 AI 编程工具。</p>
<hr>
<p><strong>想要构建更好的 LLM 代理？</strong> 研究 Claude Code 的方法：选择简洁而非复杂，利用模型的优势，通过周到的提示和工具设计创造令人愉悦的用户体验。</p>
<p>魔力不在于复杂性——而在于让模型发光的<strong>精心简洁性</strong>。</p></div><div role="none" class="flex-1"></div><div class="flex flex-row flex-wrap items-center justify-between gap-4 empty:hidden"></div><div class="@container grid gap-4 pb-6 grid-cols-2"><a class="flex flex-col gap-2 rounded-lg border p-4 text-sm transition-colors hover:bg-fd-accent/80 hover:text-fd-accent-foreground @max-lg:col-span-full" href="/docs/zh/advanced/compounding-engineering"><div class="inline-flex items-center gap-1.5 font-medium"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide -mx-1 size-4 shrink-0 rtl:rotate-180"><path d="m15 18-6-6 6-6"></path></svg><p>复合式工程：构建自我改进的开发系统</p></div><p class="text-fd-muted-foreground truncate">学习如何构建随着每次迭代变得更快、更安全、更优秀的开发系统。将你的工程工作流程从短期收益转变为永久改进。</p></a><a class="flex flex-col gap-2 rounded-lg border p-4 text-sm transition-colors hover:bg-fd-accent/80 hover:text-fd-accent-foreground @max-lg:col-span-full text-end" href="/docs/zh/best-practices"><div class="inline-flex items-center gap-1.5 font-medium flex-row-reverse"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide -mx-1 size-4 shrink-0 rtl:rotate-180"><path d="m9 18 6-6-6-6"></path></svg><p>最佳实践</p></div><p class="text-fd-muted-foreground truncate">学习有效使用 ClaudeCode 的最佳实践</p></a></div></article><div id="nd-toc" class="sticky pb-2 pt-12 max-xl:hidden" style="top:calc(var(--fd-banner-height) + var(--fd-nav-height));height:calc(100dvh - var(--fd-banner-height) - var(--fd-nav-height))"><div class="flex h-full w-(--fd-toc-width) max-w-full flex-col pe-4"><h3 class="inline-flex items-center gap-1.5 text-sm text-fd-muted-foreground"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-4"><path d="M15 18H3"></path><path d="M17 6H3"></path><path d="M21 12H3"></path></svg>On this page</h3><div class="relative min-h-0 text-sm ms-px overflow-auto [scrollbar-width:none] [mask-image:linear-gradient(to_bottom,transparent,white_16px,white_calc(100%-16px),transparent)] py-3"><div role="none" class="absolute top-(--fd-top) h-(--fd-height) w-px bg-fd-primary transition-all" style="--fd-top: 12px; --fd-height: 40px;"></div><div class="flex flex-col border-s border-fd-foreground/10"><a data-active="true" href="#是什么让-claude-code-如此出色以及如何在你的智能体中重现这种魔力" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-3">是什么让 Claude Code 如此出色（以及如何在你的智能体中重现这种魔力）!?</a><a data-active="false" href="#如何构建类似-claude-code-的智能体tldr" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-3">如何构建类似 Claude Code 的智能体：TL;DR</a><a data-active="false" href="#1-控制循环" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-6">1. 控制循环</a><a data-active="false" href="#2-提示词" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-6">2. 提示词</a><a data-active="false" href="#3-工具" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-6">3. 工具</a><a data-active="false" href="#4-可控性" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-6">4. 可控性</a><a data-active="false" href="#1-控制循环设计" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-3">1. 控制循环设计</a><a data-active="false" href="#11-保持单一主循环" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-6">1.1 保持单一主循环</a><a data-active="false" href="#12-为一切使用更小的模型" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-6">1.2 为<em>一切</em>使用更小的模型</a><a data-active="false" href="#2-提示词-1" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-3">2. 提示词</a><a data-active="false" href="#21-使用-claudemd-协作处理用户上下文和偏好" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-6">2.1 使用 claude.md 协作处理用户上下文和偏好</a><a data-active="false" href="#22-特殊的-xml-标签markdown-和大量示例" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-6">2.2 特殊的 XML 标签、Markdown 和大量示例</a><a data-active="false" href="#3-工具-1" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-3">3. 工具</a><a data-active="false" href="#31-llm-搜索--基于-rag-的搜索" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-6">3.1 LLM 搜索 &gt;&gt;&gt; 基于 RAG 的搜索</a><a data-active="false" href="#32-如何设计好的工具低级vs高级工具" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-6">3.2 如何设计好的工具？（低级vs高级工具）</a><a data-active="false" href="#33-让智能体管理待办事项列表" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-6">3.3 让智能体管理待办事项列表</a><a data-active="false" href="#4-可控性-1" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-3">4. 可控性</a><a data-active="false" href="#41-语调和风格" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-6">4.1 语调和风格</a><a data-active="false" href="#42-请注意这很重要不幸仍然是最先进的方法" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-6">4.2 "请注意这很重要"不幸仍然是最先进的方法</a><a data-active="false" href="#43-编写算法包含启发式方法和示例" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-6">4.3 编写算法（包含启发式方法和示例）</a><a data-active="false" href="#额外内容为什么要关注大型实验室的提示" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-3">额外内容：为什么要关注大型实验室的提示？</a><a data-active="false" href="#结论" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-3">结论</a><a data-active="false" href="#附录" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-3">附录</a><a data-active="false" href="#-为什么研究大实验室提示" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-3">💡 为什么研究大实验室提示？</a><a data-active="false" href="#-实施策略" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-3">🚀 实施策略</a><a data-active="false" href="#第一阶段核心架构" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-6">第一阶段：核心架构</a><a data-active="false" href="#第二阶段高级功能" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-6">第二阶段：高级功能</a><a data-active="false" href="#第三阶段优化" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-6">第三阶段：优化</a><a data-active="false" href="#-更大的图景" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-3">🎯 更大的图景</a><a data-active="false" href="#-未来影响" class="prose py-1.5 text-sm text-fd-muted-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary ps-3">🔮 未来影响</a></div></div></div></div></div><!--$--><!--/$-->